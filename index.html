<!DOCTYPE html>
<html lang="en" class="bg-gradient-to-br from-blue-50 to-indigo-50">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HealthShield - Symptom Checker</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .container {
            max-width: 900px;
        }
        
        /* Custom styles */
        .form-input {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 2px solid #e5e7eb;
            border-radius: 0.75rem;
            font-size: 1rem;
            color: #4b5563;
            transition: all 0.2s ease-in-out;
        }
        .form-input:focus {
            outline: none;
            border-color: #4f46e5;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.15);
        }
        .form-input::placeholder {
            color: #9ca3af;
        }
        
        /* Animation classes */
        .animate-fade-in {
            animation: fadeIn 0.8s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .pulse-glow {
            animation: pulseGlow 2s infinite;
        }
        @keyframes pulseGlow {
            0% { box-shadow: 0 0 5px rgba(79, 70, 229, 0.4); }
            50% { box-shadow: 0 0 20px rgba(79, 70, 229, 0.6); }
            100% { box-shadow: 0 0 5px rgba(79, 70, 229, 0.4); }
        }
        
        .symptom-checkbox:checked + .symptom-label {
            background-color: #e0e7ff;
            border-color: #4f46e5;
            color: #4f46e5;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(79, 70, 229, 0.2);
        }
        
        .risk-low { background: linear-gradient(135deg, #d1fae5, #a7f3d0); }
        .risk-medium { background: linear-gradient(135deg, #fef3c7, #fde68a); }
        .risk-high { background: linear-gradient(135deg, #fee2e2, #fecaca); }
        
        .risk-text-low { color: #065f46; }
        .risk-text-medium { color: #92400e; }
        .risk-text-high { color: #991b1b; }
        
        .icon-bg {
            background: linear-gradient(135deg, #4f46e5, #7c3aed);
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4 py-8">
    <!-- Main Card -->
    <div id="main-card" class="container bg-white rounded-3xl shadow-2xl overflow-hidden animate-fade-in">
        <!-- Header with gradient -->
        <div class="bg-gradient-to-r from-indigo-600 to-purple-600 p-6 lg:p-8 text-white">
            <div class="flex items-center justify-center mb-4">
                <div class="icon-bg rounded-full p-3 mr-3">
                    <i class="fas fa-shield-alt text-white text-2xl"></i>
                </div>
                <h1 class="text-3xl lg:text-4xl font-extrabold">HealthShield</h1>
            </div>
            <p class="text-center text-indigo-100 max-w-lg mx-auto text-lg">
                Advanced tool to identify potential water-borne disease risks based on your symptoms
            </p>
        </div>
        
        <div class="p-6 lg:p-8 space-y-8">
            <!-- User Information Form -->
            <div id="user-info-section" class="bg-gradient-to-br from-gray-50 to-blue-50 p-6 rounded-2xl border border-gray-200 space-y-4">
                <div class="flex items-center">
                    <i class="fas fa-user-circle text-indigo-500 text-xl mr-2"></i>
                    <h2 class="text-xl font-semibold text-gray-800">Your Information</h2>
                </div>
                <form id="user-form" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label for="userName" class="block text-sm font-medium text-gray-700 mb-1">Full Name *</label>
                        <input type="text" id="userName" placeholder="Enter your full name" required class="form-input">
                    </div>
                    <div>
                        <label for="userAge" class="block text-sm font-medium text-gray-700 mb-1">Age *</label>
                        <input type="number" id="userAge" placeholder="Your age" required class="form-input">
                    </div>
                    <div>
                        <label for="userGender" class="block text-sm font-medium text-gray-700 mb-1">Gender *</label>
                        <select id="userGender" required class="form-input">
                            <option value="" disabled selected>Select your gender</option>
                            <option value="male">Male</option>
                            <option value="female">Female</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div>
                        <label for="userVillage" class="block text-sm font-medium text-gray-700 mb-1">Village / Area *</label>
                        <input type="text" id="userVillage" placeholder="Your village or area" required class="form-input">
                    </div>
                    <div>
                        <label for="userMobile" class="block text-sm font-medium text-gray-700 mb-1">Mobile Number</label>
                        <input type="tel" id="userMobile" placeholder="Optional contact number" class="form-input">
                    </div>
                    <div>
                        <label for="userEmail" class="block text-sm font-medium text-gray-700 mb-1">Email Address</label>
                        <input type="email" id="userEmail" placeholder="Optional email address" class="form-input">
                    </div>
                </form>
            </div>

            <!-- Symptoms Section -->
            <div id="symptoms-section" class="space-y-6">
                <div class="flex items-center">
                    <i class="fas fa-stethoscope text-indigo-500 text-xl mr-2"></i>
                    <h2 class="text-xl font-semibold text-gray-800">Select Your Symptoms</h2>
                </div>
                <div id="symptom-list" class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-4">
                    <!-- Symptoms will be dynamically loaded here -->
                </div>
                <p class="text-sm text-gray-500 text-center">
                    <i class="fas fa-info-circle mr-1"></i> Select all symptoms that apply to you.
                </p>
            </div>

            <!-- Submission and Loading -->
            <div class="space-y-4">
                <button id="analyzeBtn" class="w-full bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-bold py-4 px-6 rounded-xl shadow-lg hover:from-indigo-700 hover:to-purple-700 transition-all duration-300 transform hover:-translate-y-1 pulse-glow">
                    <i class="fas fa-search-medical mr-2"></i> Analyze Symptoms
                </button>
                <div id="loading" class="hidden text-center text-gray-600">
                    <div class="inline-flex items-center bg-blue-50 p-4 rounded-xl">
                        <svg class="animate-spin h-6 w-6 text-blue-500 mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                        <p>Analyzing your symptoms...</p>
                    </div>
                </div>
            </div>

            <!-- Results Display -->
            <div id="results" class="hidden rounded-2xl border border-gray-200 overflow-hidden space-y-4 text-center">
                <div id="results-header" class="p-4 text-white">
                    <h2 class="text-2xl font-bold"><i class="fas fa-clipboard-check mr-2"></i>Analysis Results</h2>
                </div>
                <div class="p-6">
                    <p id="risk-level" class="text-3xl font-extrabold mb-2"></p>
                    <p id="result-message" class="text-lg mb-4"></p>
                    <ul id="detected-diseases" class="space-y-2 mx-auto max-w-md text-left"></ul>
                    <p class="text-sm text-gray-500 mt-6">
                        <i class="fas fa-exclamation-triangle mr-1"></i> For an accurate diagnosis, please consult a qualified healthcare professional.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification and Modal -->
    <div id="notification-modal" class="fixed inset-0 z-50 bg-black bg-opacity-50 hidden items-center justify-center p-4">
        <div class="bg-white rounded-xl shadow-xl p-6 w-full max-w-sm space-y-4 animate-fade-in">
            <div id="modal-icon" class="text-center text-4xl"></div>
            <h3 id="modal-title" class="text-xl font-bold text-center"></h3>
            <p id="modal-message" class="text-center text-gray-600"></p>
            <button id="modal-close-btn" class="w-full bg-indigo-600 text-white font-bold py-2 rounded-lg hover:bg-indigo-700 transition">OK</button>
        </div>
    </div>

    <!-- JavaScript Logic -->
    <script>
        // Set the base URL for the backend API.
        // CHANGE THIS TO YOUR LIVE SERVER URL AFTER DEPLOYMENT
        const BASE_API_URL = 'https://web-production-4b6b9.up.railway.app/';

        // Symptom data
        const SYMPTOMS = [
            { id: 1, name: "Fever", icon: "fas fa-thermometer-half" },
            { id: 2, name: "Stomach Ache", icon: "fas fa-stomach" },
            { id: 3, name: "Vomiting", icon: "fas fa-procedures" },
            { id: 4, name: "Headache", icon: "fas fa-head-side-virus" },
            { id: 5, name: "Dehydration", icon: "fas fa-tint-slash" },
            { id: 6, name: "Jaundice", icon: "fas fa-sun" },
            { id: 7, name: "Rash", icon: "fas fa-allergies" },
            { id: 8, name: "Weakness", icon: "fas fa-tired" },
            { id: 9, name: "Diarrhea", icon: "fas fa-toilet" },
            { id: 10, name: "Muscle Aches", icon: "fas fa-dumbbell" },
            { id: 11, name: "Blood in Stool", icon: "fas fa-tint" },
            { id: 12, name: "Cough", icon: "fas fa-lungs-virus" }
        ];

        // UI elements
        const symptomListEl = document.getElementById('symptom-list');
        const analyzeBtn = document.getElementById('analyzeBtn');
        const loadingEl = document.getElementById('loading');
        const resultsEl = document.getElementById('results');
        const resultsHeader = document.getElementById('results-header');
        const userForm = document.getElementById('user-form');
        const notificationModal = document.getElementById('notification-modal');
        const modalTitle = document.getElementById('modal-title');
        const modalMessage = document.getElementById('modal-message');
        const modalIcon = document.getElementById('modal-icon');
        const modalCloseBtn = document.getElementById('modal-close-btn');

        let selectedSymptoms = [];
        let userData = {};

        // Function to create a custom notification modal
        function showNotification(message, type) {
            let icon = '';
            let title = '';
            let iconColor = '';
            
            if (type === 'success') {
                title = 'Success!';
                icon = '✅';
                iconColor = 'text-green-500';
            } else if (type === 'warning') {
                title = 'Warning!';
                icon = '⚠️';
                iconColor = 'text-yellow-500';
            } else if (type === 'error') {
                title = 'Error!';
                icon = '❌';
                iconColor = 'text-red-500';
            }

            modalTitle.textContent = title;
            modalMessage.textContent = message;
            modalIcon.textContent = icon;
            modalIcon.className = `text-center text-4xl ${iconColor}`;
            notificationModal.classList.remove('hidden');
            notificationModal.classList.add('flex');
        }

        modalCloseBtn.addEventListener('click', () => {
            notificationModal.classList.add('hidden');
            notificationModal.classList.remove('flex');
        });

        // Function to render the symptom list
        function renderSymptoms() {
            symptomListEl.innerHTML = SYMPTOMS.map(symptom => `
                <div class="relative">
                    <input type="checkbox" id="symptom-${symptom.id}" data-id="${symptom.id}" class="symptom-checkbox absolute opacity-0 h-0 w-0">
                    <label for="symptom-${symptom.id}" class="symptom-label flex flex-col items-center justify-center p-4 bg-white border-2 border-gray-200 rounded-xl cursor-pointer hover:bg-gray-50 transition-all duration-300 h-full">
                        <i class="${symptom.icon} text-2xl text-gray-600 mb-2"></i>
                        <span class="text-sm font-medium text-gray-700 text-center">${symptom.name}</span>
                    </label>
                </div>
            `).join('');
            
            symptomListEl.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                checkbox.addEventListener('change', (e) => {
                    const id = parseInt(e.target.dataset.id);
                    if (e.target.checked) {
                        selectedSymptoms.push(id);
                    } else {
                        selectedSymptoms = selectedSymptoms.filter(s => s !== id);
                    }
                });
            });
        }

        // Function to validate user form data
        function validateForm() {
            const name = document.getElementById('userName').value.trim();
            const age = document.getElementById('userAge').value.trim();
            const gender = document.getElementById('userGender').value;
            const village = document.getElementById('userVillage').value.trim();
            
            if (!name) {
                showNotification('Please enter your name', 'warning');
                return false;
            }
            if (!age || age < 1 || age > 120) {
                showNotification('Please enter a valid age', 'warning');
                return false;
            }
            if (!gender) {
                showNotification('Please select your gender', 'warning');
                return false;
            }
            if (!village) {
                showNotification('Please enter your village name', 'warning');
                return false;
            }
            
            userData = {
                name: name,
                age: parseInt(age),
                gender: gender,
                village: village,
                mobile: document.getElementById('userMobile').value.trim() || null,
                email: document.getElementById('userEmail').value.trim() || null
            };
            
            return true;
        }

        // Function to show/hide loading indicator
        function showLoading(show) {
            loadingEl.classList.toggle('hidden', !show);
            analyzeBtn.disabled = show;
            analyzeBtn.classList.toggle('opacity-50', show);
            analyzeBtn.classList.toggle('pulse-glow', !show);
        }

        // Function to show analysis results
        function showResults(riskLevel, matchingDiseases, riskScore) {
            const riskLevelEl = document.getElementById('risk-level');
            const resultMessageEl = document.getElementById('result-message');
            const detectedDiseasesEl = document.getElementById('detected-diseases');

            riskLevelEl.textContent = `${riskLevel.toUpperCase()} RISK DETECTED`;
            
            // Set risk-specific styling
            let riskClass = 'risk-low';
            let riskTextClass = 'risk-text-low';
            let riskHeaderClass = 'bg-gradient-to-r from-green-500 to-emerald-500';
            
            if (riskLevel === 'medium') {
                riskClass = 'risk-medium';
                riskTextClass = 'risk-text-medium';
                riskHeaderClass = 'bg-gradient-to-r from-yellow-500 to-amber-500';
            } else if (riskLevel === 'high') {
                riskClass = 'risk-high';
                riskTextClass = 'risk-text-high';
                riskHeaderClass = 'bg-gradient-to-r from-red-500 to-pink-500';
            }
            
            resultsEl.className = `rounded-2xl border border-gray-200 overflow-hidden space-y-4 text-center ${riskClass}`;
            resultsHeader.className = `p-4 text-white ${riskHeaderClass}`;
            riskLevelEl.className = `text-3xl font-extrabold mb-2 ${riskTextClass}`;
            
            detectedDiseasesEl.innerHTML = '';
            if (matchingDiseases && matchingDiseases.length > 0) {
                resultMessageEl.textContent = 'Potential water-borne diseases based on your symptoms:';
                matchingDiseases.forEach(disease => {
                    const li = document.createElement('li');
                    li.className = 'flex items-center bg-white bg-opacity-70 p-2 rounded-lg';
                    li.innerHTML = `
                        <i class="fas fa-virus text-red-500 mr-2"></i>
                        <span class="font-medium">${disease.name}</span>
                        <span class="ml-auto bg-gray-100 px-2 py-1 rounded text-sm font-semibold">${disease.match_percentage.toFixed(0)}% match</span>
                    `;
                    detectedDiseasesEl.appendChild(li);
                });
            } else {
                resultMessageEl.textContent = 'No serious water-borne disease detected. Your health appears good!';
            }
            
            resultsEl.classList.remove('hidden');
            resultsEl.scrollIntoView({ behavior: 'smooth' });
        }

        // Main function to analyze symptoms
        async function analyzeSymptoms() {
            if (selectedSymptoms.length === 0) {
                showNotification('Please select at least one symptom', 'warning');
                return;
            }
            
            if (!validateForm()) {
                return;
            }
            
            showLoading(true);
            resultsEl.classList.add('hidden');

            try {
                const response = await fetch(`${BASE_API_URL}/api/analyze`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        name: userData.name,
                        age: userData.age,
                        gender: userData.gender,
                        village: userData.village,
                        mobile: userData.mobile,
                        email: userData.email,
                        symptoms: selectedSymptoms
                    })
                });
                
                const result = await response.json();
                
                if (response.ok && result.success) {
                    showResults(result.risk_level, result.matching_diseases, result.risk_score);
                    showNotification(result.message, result.risk_level === 'high' ? 'warning' : 'success');
                } else {
                    const errorMsg = result.error || 'Unknown error occurred.';
                    showNotification('Analysis failed: ' + errorMsg, 'error');
                }
            } catch (error) {
                console.error('Network or server error:', error);
                showNotification('Connection error. Please ensure the backend server is running.', 'error');
            } finally {
                showLoading(false);
            }
        }

        // Event listener for the analyze button
        analyzeBtn.addEventListener('click', analyzeSymptoms);

        // Initial setup
        document.addEventListener('DOMContentLoaded', () => {
            renderSymptoms();
        });

    </script>
</body>
</html>
